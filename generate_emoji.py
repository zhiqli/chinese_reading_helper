#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Script to generate emoji for each article in all_articles_data.json
"""

import json
import sys
from typing import Dict, List, Any

def generate_emoji(title: str) -> str:
    """æ ¹æ®æ ‡é¢˜ç”Ÿæˆ emoji çš„å‡½æ•°"""
    emoji_map = {
        'æ˜¥': 'ðŸŒ¸', 'å¤': 'â˜€ï¸', 'ç§‹': 'ðŸ‚', 'å†¬': 'â„ï¸',
        'èŠ±': 'ðŸŒº', 'æ ‘': 'ðŸŒ³', 'å¶': 'ðŸƒ', 'è‰': 'ðŸŒ±',
        'é›¨': 'ðŸŒ§ï¸', 'é›ª': 'â„ï¸', 'é£Ž': 'ðŸ’¨', 'äº‘': 'â˜ï¸',
        'å¤ªé˜³': 'â˜€ï¸', 'æœˆ': 'ðŸŒ™', 'æ˜Ÿ': 'â­', 'å¤©': 'ðŸŒ¤ï¸',
        'å±±': 'â›°ï¸', 'æ°´': 'ðŸ’§', 'æ²³': 'ðŸžï¸', 'æµ·': 'ðŸŒŠ',
        'åŠ¨ç‰©': 'ðŸ¾', 'é¸Ÿ': 'ðŸ¦', 'é±¼': 'ðŸŸ', 'è™«': 'ðŸ›',
        'å…”': 'ðŸ°', 'é¸¡': 'ðŸ”', 'ç‰›': 'ðŸ„', 'é©¬': 'ðŸŽ',
        'çŒ«': 'ðŸ±', 'ç‹—': 'ðŸ¶', 'ç†Š': 'ðŸ»', 'è±¡': 'ðŸ˜',
        'é¼ ': 'ðŸ­', 'è™Ž': 'ðŸ¯', 'é¾™': 'ðŸ‰', 'è›‡': 'ðŸ',
        'ç¾Š': 'ðŸ‘', 'çŒ´': 'ðŸµ', 'é¸¡': 'ðŸ“', 'ç‹—': 'ðŸ•',
        'çŒª': 'ðŸ·', 'è›™': 'ðŸ¸', 'èŒèšª': 'ðŸ¸', 'é¸­': 'ðŸ¦†',
        'ç‡•': 'ðŸ•Šï¸', 'é¹…': 'ðŸ¦†', 'èœ—ç‰›': 'ðŸŒ', 'èœ˜è››': 'ðŸ•·ï¸',
        'å­¦': 'ðŸ“š', 'ä¹¦': 'ðŸ“–', 'å†™': 'âœï¸', 'ç”»': 'ðŸŽ¨',
        'è¯»': 'ðŸ“–', 'å­—': 'ðŸ”¤', 'è¯': 'ðŸ“', 'è¯—': 'ðŸ“œ',
        'å”±': 'ðŸŽµ', 'è·³': 'ðŸ’ƒ', 'ç¬‘': 'ðŸ˜Š', 'å“­': 'ðŸ˜¢',
        'å®¶': 'ðŸ ', 'å­¦æ ¡': 'ðŸ«', 'è·¯': 'ðŸ›¤ï¸', 'æ¡¥': 'ðŸŒ‰',
        'è½¦': 'ðŸš—', 'èˆ¹': 'â›µ', 'é£žæœº': 'âœˆï¸', 'ç«è½¦': 'ðŸš‚',
        'çº¢': 'ðŸ”´', 'ç»¿': 'ðŸŸ¢', 'è“': 'ðŸ”µ', 'é»„': 'ðŸŸ¡',
        'å¤§': 'ðŸ”´', 'å°': 'ðŸ”µ', 'é«˜': 'â¬†ï¸', 'çŸ®': 'â¬‡ï¸',
        'æ•°å­—': 'ðŸ”¢', 'ä¸€': '1ï¸âƒ£', 'äºŒ': '2ï¸âƒ£', 'ä¸‰': '3ï¸âƒ£',
        'å››': '4ï¸âƒ£', 'äº”': '5ï¸âƒ£', 'å…­': '6ï¸âƒ£', 'ä¸ƒ': '7ï¸âƒ£',
        'å…«': '8ï¸âƒ£', 'ä¹': '9ï¸âƒ£', 'å': 'ðŸ”Ÿ',
        'å¤è¯—': 'ðŸ“œ', 'æ•…äº‹': 'ðŸ“š', 'ç«¥è¯': 'ðŸ§š',
        'æ˜¥å¤©': 'ðŸŒ¸', 'å¤å¤©': 'â˜€ï¸', 'ç§‹å¤©': 'ðŸ‚', 'å†¬å¤©': 'â„ï¸',
        'æ¢…': 'ðŸŒ¸', 'å…°': 'ðŸŒº', 'ç«¹': 'ðŸŽ‹', 'èŠ': 'ðŸŒ¼',
        'æ¾': 'ðŸŒ²', 'æŸ': 'ðŸŒ²', 'è·': 'ðŸª·', 'èŽ²': 'ðŸª·',
        'æ¡ƒ': 'ðŸ‘', 'æŽ': 'ðŸƒ', 'æ¢¨': 'ðŸ', 'æ©˜': 'ðŸŠ',
        'è‹¹æžœ': 'ðŸŽ', 'é¦™è•‰': 'ðŸŒ', 'è¥¿ç“œ': 'ðŸ‰',
        'é•¿åŸŽ': 'ðŸ¯', 'å¤©å®‰é—¨': 'ðŸ›ï¸', 'åŒ—äº¬': 'ðŸ›ï¸',
        'æ•…ä¹¡': 'ðŸ ', 'å®¶ä¹¡': 'ðŸ ', 'å¦ˆå¦ˆ': 'ðŸ‘©', 'çˆ¸çˆ¸': 'ðŸ‘¨',
        'çˆ·çˆ·': 'ðŸ‘´', 'å¥¶å¥¶': 'ðŸ‘µ', 'è€å¸ˆ': 'ðŸ‘©â€ðŸ«',
        'æœ‹å‹': 'ðŸ‘«', 'å°æœ‹å‹': 'ðŸ‘§', 'å­©å­': 'ðŸ‘¶',
        'çœ¼ç›': 'ðŸ‘ï¸', 'è€³æœµ': 'ðŸ‘‚', 'é¼»å­': 'ðŸ‘ƒ', 'å˜´': 'ðŸ‘„',
        'æ‰‹': 'âœ‹', 'è„š': 'ðŸ¦¶', 'å¤´': 'ðŸ‘¤', 'å¿ƒ': 'â¤ï¸',
        'çˆ±': 'â¤ï¸', 'æƒ³': 'ðŸ’­', 'çœ‹': 'ðŸ‘€', 'å¬': 'ðŸ‘‚',
        'è¯´': 'ðŸ’¬', 'èµ°': 'ðŸš¶', 'è·‘': 'ðŸƒ', 'é£ž': 'ðŸ•Šï¸',
        'æ¸¸': 'ðŸŠ', 'æ³³': 'ðŸŠ', 'æ»‘': 'â›·ï¸', 'çˆ¬': 'ðŸ§—',
        'ç¯': 'ðŸ’¡', 'ç¯ç¬¼': 'ðŸ®', 'èœ¡çƒ›': 'ðŸ•¯ï¸', 'ç«': 'ðŸ”¥',
        'ç”µ': 'âš¡', 'é›·': 'âš¡', 'é—ªç”µ': 'âš¡',
        'å½©è™¹': 'ðŸŒˆ', 'æ˜Ÿæ˜Ÿ': 'â­', 'æœˆäº®': 'ðŸŒ™',
        'åœ°çƒ': 'ðŸŒ', 'ä¸–ç•Œ': 'ðŸŒŽ', 'å®‡å®™': 'ðŸŒŒ',
        'éŸ³ä¹': 'ðŸŽµ', 'æ­Œ': 'ðŸŽ¤', 'èˆž': 'ðŸ’ƒ', 'æˆ': 'ðŸŽ­',
        'çƒ': 'âš½', 'ç¯®çƒ': 'ðŸ€', 'è¶³çƒ': 'âš½', 'ä¹’ä¹“': 'ðŸ“',
        'æ¸¸æˆ': 'ðŸŽ®', 'çŽ©å…·': 'ðŸ§¸', 'ç¤¼ç‰©': 'ðŸŽ',
        'ç”Ÿæ—¥': 'ðŸŽ‚', 'èŠ‚æ—¥': 'ðŸŽ‰', 'æ˜¥èŠ‚': 'ðŸ§§',
        'æ¢¦': 'ðŸ’¤', 'ç¡': 'ðŸ˜´', 'é†’': 'ðŸ˜ƒ', 'èµ·': 'â¬†ï¸',
        'å': 'ðŸª‘', 'ç«™': 'ðŸ§', 'èºº': 'ðŸ›Œ',
        'åƒ': 'ðŸ½ï¸', 'å–': 'ðŸ¥¤', 'é¥­': 'ðŸš', 'èœ': 'ðŸ¥¬',
        'æžœ': 'ðŸŽ', 'è‚‰': 'ðŸ¥©', 'è›‹': 'ðŸ¥š', 'å¥¶': 'ðŸ¥›',
        'ç³–': 'ðŸ­', 'èœœ': 'ðŸ¯', 'ç›': 'ðŸ§‚',
        'è¡£': 'ðŸ‘•', 'è£¤': 'ðŸ‘–', 'éž‹': 'ðŸ‘Ÿ', 'å¸½': 'ðŸ‘’',
        'ä¼ž': 'â˜‚ï¸', 'åŒ…': 'ðŸŽ’', 'çœ¼é•œ': 'ðŸ‘“',
        'é’Ÿ': 'ðŸ•', 'è¡¨': 'âŒš', 'é—¹é’Ÿ': 'â°',
        'é—¨': 'ðŸšª', 'çª—': 'ðŸªŸ', 'å¢™': 'ðŸ§±', 'å±‹': 'ðŸ ',
        'åºŠ': 'ðŸ›ï¸', 'æ¡Œ': 'ðŸª‘', 'æ¤…': 'ðŸª‘',
        'ç¬”': 'âœï¸', 'çº¸': 'ðŸ“„', 'æœ¬': 'ðŸ““', 'åŒ…': 'ðŸŽ’',
        'å°º': 'ðŸ“', 'æ©¡çš®': 'ðŸ§½', 'å‰ªåˆ€': 'âœ‚ï¸',
        'é’±': 'ðŸ’°', 'å¸': 'ðŸª™', 'å…ƒ': 'ðŸ’´',
        'ä¹°': 'ðŸ›’', 'å–': 'ðŸª', 'å¸‚åœº': 'ðŸª',
        'åŒ»ç”Ÿ': 'ðŸ‘¨â€âš•ï¸', 'æŠ¤å£«': 'ðŸ‘©â€âš•ï¸', 'ç—…': 'ðŸ¤’',
        'è¯': 'ðŸ’Š', 'åŒ»é™¢': 'ðŸ¥',
        'è­¦å¯Ÿ': 'ðŸ‘®', 'æ¶ˆé˜²': 'ðŸš’', 'æ•‘æŠ¤': 'ðŸš‘',
        'å·¥äºº': 'ðŸ‘·', 'å†œæ°‘': 'ðŸ‘¨â€ðŸŒ¾', 'å¸æœº': 'ðŸ‘¨â€âœˆï¸',
        'é‚®é€’å‘˜': 'ðŸ“¬', 'åŽ¨å¸ˆ': 'ðŸ‘¨â€ðŸ³',
        'ç§‘å­¦': 'ðŸ”¬', 'å®žéªŒ': 'ðŸ§ª', 'å‘æ˜Ž': 'ðŸ’¡',
        'ç”µè„‘': 'ðŸ’»', 'æ‰‹æœº': 'ðŸ“±', 'ç”µè§†': 'ðŸ“º',
        'æ”¶éŸ³æœº': 'ðŸ“»', 'ç›¸æœº': 'ðŸ“·'
    }
    
    # æ£€æŸ¥æ ‡é¢˜ä¸­æ˜¯å¦åŒ…å«å…³é”®è¯ï¼ŒæŒ‰é•¿åº¦æŽ’åºä»¥ä¼˜å…ˆåŒ¹é…é•¿è¯
    keywords = sorted(emoji_map.keys(), key=len, reverse=True)
    for keyword in keywords:
        if keyword in title:
            return emoji_map[keyword]
    
    # é»˜è®¤ emoji
    return 'ðŸ“–'

def load_json_file(filepath: str) -> Any:
    """Load and parse JSON file"""
    try:
        with open(filepath, 'r', encoding='utf-8') as f:
            return json.load(f)
    except FileNotFoundError:
        print(f"Error: File {filepath} not found")
        sys.exit(1)
    except json.JSONDecodeError as e:
        print(f"Error: Invalid JSON in {filepath}: {e}")
        sys.exit(1)

def save_json_file(data: Any, filepath: str) -> None:
    """Save data to JSON file"""
    try:
        with open(filepath, 'w', encoding='utf-8') as f:
            json.dump(data, f, ensure_ascii=False, indent=2)
        print(f"Successfully saved to {filepath}")
    except Exception as e:
        print(f"Error saving to {filepath}: {e}")
        sys.exit(1)

def main():
    # File paths
    articles_json_path = '/Users/zhiqli/github/chinese_reading_helper/all_articles_data.json'
    backup_path = '/Users/zhiqli/github/chinese_reading_helper/all_articles_data_backup_emoji.json'
    
    print("Loading articles data...")
    
    # Load data
    articles_data = load_json_file(articles_json_path)
    
    print(f"Loaded {len(articles_data)} articles from all_articles_data.json")
    
    # Create backup
    print("Creating backup...")
    save_json_file(articles_data, backup_path)
    
    # Add emoji to each article
    print("Generating emojis for articles...")
    emoji_stats = {}
    
    for i, article in enumerate(articles_data):
        title = article.get('title', '')
        emoji = generate_emoji(title)
        article['emoji'] = emoji
        
        # ç»Ÿè®¡ emoji ä½¿ç”¨æƒ…å†µ
        if emoji not in emoji_stats:
            emoji_stats[emoji] = 0
        emoji_stats[emoji] += 1
        
        if i < 10:  # æ˜¾ç¤ºå‰10ä¸ªä¾‹å­
            print(f"  {title} -> {emoji}")
    
    print(f"\nEmoji distribution:")
    for emoji, count in sorted(emoji_stats.items(), key=lambda x: x[1], reverse=True):
        print(f"  {emoji}: {count} articles")
    
    # Save updated data
    print(f"\nSaving updated data...")
    save_json_file(articles_data, articles_json_path)
    
    print(f"\nEmoji generation completed successfully!")
    print(f"Updated {len(articles_data)} articles with emoji icons")

if __name__ == '__main__':
    main()